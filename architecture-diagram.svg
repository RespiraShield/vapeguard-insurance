<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="blueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1E40AF;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="greenGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="orangeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="purpleGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="800" fill="#F8FAFC"/>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#1F2937">VapeGuard Email Server Architecture</text>
  
  <!-- VapeGuard Portal Section -->
  <rect x="50" y="60" width="1100" height="120" fill="url(#blueGradient)" rx="10" opacity="0.1"/>
  <text x="70" y="85" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1F2937">VapeGuard Insurance Portal</text>
  
  <!-- Frontend -->
  <rect x="70" y="100" width="200" height="60" fill="url(#blueGradient)" rx="5"/>
  <text x="170" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Frontend (React)</text>
  <text x="170" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Port: 3000</text>
  <text x="170" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Personal Details + OTP</text>
  
  <!-- Backend API -->
  <rect x="300" y="100" width="200" height="60" fill="url(#greenGradient)" rx="5"/>
  <text x="400" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Backend API (Node.js)</text>
  <text x="400" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Port: 5000</text>
  <text x="400" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">verificationHandler</text>
  
  <!-- Email Server -->
  <rect x="530" y="100" width="200" height="60" fill="url(#orangeGradient)" rx="5"/>
  <text x="630" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Email Server (Node.js)</text>
  <text x="630" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Port: 3001</text>
  <text x="630" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Direct SMTP</text>
  
  <!-- Arrows between portal components -->
  <path d="M 270 130 L 300 130" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 500 130 L 530 130" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Email Server Core Section -->
  <rect x="50" y="200" width="1100" height="280" fill="url(#purpleGradient)" rx="10" opacity="0.1"/>
  <text x="70" y="225" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1F2937">Email Server Core Components</text>
  
  <!-- DirectMailer -->
  <rect x="70" y="240" width="180" height="100" fill="url(#blueGradient)" rx="5"/>
  <text x="160" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">DirectMailer</text>
  <text x="160" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• MX Lookup &amp; Caching</text>
  <text x="160" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• SMTP Client</text>
  <text x="160" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Email Formatting</text>
  <text x="160" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Failover Logic</text>
  
  <!-- Email Templates -->
  <rect x="270" y="240" width="180" height="100" fill="url(#greenGradient)" rx="5"/>
  <text x="360" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Email Templates</text>
  <text x="360" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• OTP Template</text>
  <text x="360" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Professional HTML</text>
  <text x="360" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• VapeGuard Branding</text>
  <text x="360" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Minified Content</text>
  
  <!-- Winston Logger -->
  <rect x="470" y="240" width="180" height="100" fill="url(#orangeGradient)" rx="5"/>
  <text x="560" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Winston Logger</text>
  <text x="560" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Daily Rotate Files</text>
  <text x="560" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Structured JSON</text>
  <text x="560" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Multiple Log Levels</text>
  <text x="560" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Request Logging</text>
  
  <!-- MockSMTPServer -->
  <rect x="670" y="240" width="180" height="100" fill="url(#purpleGradient)" rx="5"/>
  <text x="760" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">MockSMTPServer</text>
  <text x="760" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Development Mode</text>
  <text x="760" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• In-Memory Storage</text>
  <text x="760" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Email Simulation</text>
  <text x="760" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Testing Support</text>
  
  <!-- Configuration -->
  <rect x="870" y="240" width="180" height="100" fill="#6B7280" rx="5"/>
  <text x="960" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Configuration</text>
  <text x="960" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• USE_CUSTOM_SMTP</text>
  <text x="960" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• EMAIL_DOMAIN</text>
  <text x="960" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• LOG_LEVEL</text>
  <text x="960" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• NODE_ENV</text>
  
  <!-- Performance Metrics -->
  <rect x="70" y="360" width="980" height="100" fill="#F3F4F6" rx="5" stroke="#D1D5DB"/>
  <text x="80" y="380" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1F2937">Performance Optimizations</text>
  
  <rect x="90" y="390" width="180" height="60" fill="#EFF6FF" rx="3" stroke="#3B82F6"/>
  <text x="180" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1F2937">MX Caching</text>
  <text x="180" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">5min TTL</text>
  <text x="180" y="440" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">90% DNS reduction</text>
  
  <rect x="290" y="390" width="180" height="60" fill="#F0FDF4" rx="3" stroke="#10B981"/>
  <text x="380" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1F2937">Limited MX Attempts</text>
  <text x="380" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">Max 2 servers</text>
  <text x="380" y="440" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">15s timeout</text>
  
  <rect x="490" y="390" width="180" height="60" fill="#FFFBEB" rx="3" stroke="#F59E0B"/>
  <text x="580" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1F2937">Optimized Templates</text>
  <text x="580" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">Minified HTML</text>
  <text x="580" y="440" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">Inline CSS</text>
  
  <rect x="690" y="390" width="180" height="60" fill="#FDF4FF" rx="3" stroke="#8B5CF6"/>
  <text x="780" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1F2937">Connection Mgmt</text>
  <text x="780" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">Aggressive timeouts</text>
  <text x="780" y="440" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#374151">Resource cleanup</text>
  
  <!-- External Mail Servers Section -->
  <rect x="50" y="500" width="1100" height="180" fill="url(#greenGradient)" rx="10" opacity="0.1"/>
  <text x="70" y="525" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1F2937">External Mail Servers</text>
  
  <!-- DNS System -->
  <rect x="70" y="540" width="180" height="80" fill="url(#blueGradient)" rx="5"/>
  <text x="160" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">DNS System</text>
  <text x="160" y="575" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• MX Record Lookup</text>
  <text x="160" y="590" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• gmail.com</text>
  <text x="160" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• teleworm.us</text>
  
  <!-- MX Servers -->
  <rect x="300" y="540" width="180" height="80" fill="url(#greenGradient)" rx="5"/>
  <text x="390" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">MX Servers</text>
  <text x="390" y="575" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Gmail SMTP</text>
  <text x="390" y="590" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Outlook SMTP</text>
  <text x="390" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Port 25</text>
  
  <!-- SMTP Protocol -->
  <rect x="530" y="540" width="200" height="80" fill="url(#orangeGradient)" rx="5"/>
  <text x="630" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">SMTP Protocol</text>
  <text x="630" y="575" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">HELO → MAIL FROM → RCPT TO</text>
  <text x="630" y="590" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">DATA → Content → QUIT</text>
  <text x="630" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">Direct Connection</text>
  
  <!-- Data Flow Arrows -->
  <path d="M 630 160 L 630 200" stroke="#374151" stroke-width="3" marker-end="url(#arrowhead)"/>
  <path d="M 160 340 L 160 500" stroke="#374151" stroke-width="3" marker-end="url(#arrowhead)"/>
  <path d="M 250 580 L 300 580" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 480 580 L 530 580" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Mode Indicators -->
  <rect x="800" y="540" width="180" height="40" fill="#FEF3C7" rx="5" stroke="#F59E0B"/>
  <text x="890" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#92400E">Development Mode</text>
  <text x="890" y="575" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#92400E">USE_CUSTOM_SMTP=false</text>
  
  <rect x="800" y="590" width="180" height="40" fill="#D1FAE5" rx="5" stroke="#10B981"/>
  <text x="890" y="610" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#065F46">Production Mode</text>
  <text x="890" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#065F46">USE_CUSTOM_SMTP=true</text>
  
  <!-- Key Features Box -->
  <rect x="50" y="700" width="1100" height="80" fill="#F9FAFB" rx="5" stroke="#E5E7EB"/>
  <text x="70" y="720" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1F2937">Key Features</text>
  
  <text x="70" y="740" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ No third-party dependencies (Gmail, SendGrid, etc.)</text>
  <text x="70" y="755" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ Direct SMTP delivery to recipient mail servers</text>
  <text x="70" y="770" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ Production-grade logging with Winston</text>
  
  <text x="400" y="740" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ MX record caching for 90% performance improvement</text>
  <text x="400" y="755" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ Professional OTP email templates</text>
  <text x="400" y="770" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ Mock mode for development and testing</text>
  
  <text x="750" y="740" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ Automatic failover between MX servers</text>
  <text x="750" y="755" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ Optimized timeouts and connection management</text>
  <text x="750" y="770" font-family="Arial, sans-serif" font-size="11" fill="#374151">✓ Complete independence from external email services</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>
</svg>
